<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obscura — Secure Message Studio</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <style>
        body {
            transition: background 0.4s, color 0.4s
        }

        .page {
            display: none
        }

        .page.active {
            display: block
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: black;
            transform: translateY(-100%);
            z-index: 100
        }

        .light .overlay {
            background: white
        }

        canvas {
            display: none
        }
    </style>
</head>

<body class="bg-neutral-950 text-neutral-100 font-sans">

    <div class="overlay"></div>

    <nav class="fixed w-full backdrop-blur-md bg-opacity-60 border-b border-neutral-800 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold">Obscura</div>
            <div class="flex gap-8 text-sm">
                <a href="#home" data-link>Home</a>
                <a href="#encrypt" data-link>Encrypt</a>
                <a href="#decrypt" data-link>Decrypt</a>
                <button id="themeToggle" class="border px-4 py-1 rounded-full text-xs">Toggle</button>
            </div>
        </div>
    </nav>

    <div class="pt-24"></div>

    <!-- HOME -->
    <section data-page="home" class="page active max-w-6xl mx-auto px-6 space-y-20 pb-32">
        <h1 class="text-6xl md:text-8xl font-bold leading-tight">
            Secure messages. Hidden in plain sight.
        </h1>
        <p class="text-xl text-neutral-400 max-w-3xl">
            Obscura combines AES-256 encryption with image-based steganography,
            allowing you to encrypt sensitive messages and invisibly embed them inside images —
            all inside your browser.
        </p>

        <div class="grid md:grid-cols-3 gap-12">
            <div>
                <h3 class="text-xl font-semibold">AES-256 Encryption</h3>
                <p class="text-neutral-400 mt-2">Military-grade symmetric encryption powered by Web Crypto API.</p>
            </div>
            <div>
                <h3 class="text-xl font-semibold">Image Steganography</h3>
                <p class="text-neutral-400 mt-2">Least Significant Bit encoding hides encrypted payload in pixels.</p>
            </div>
            <div>
                <h3 class="text-xl font-semibold">Client-Side Only</h3>
                <p class="text-neutral-400 mt-2">No server. No storage. Everything runs securely in your browser.</p>
            </div>
        </div>
    </section>

    <!-- ENCRYPT -->
    <section data-page="encrypt" class="page max-w-5xl mx-auto px-6 space-y-12 pb-32">
        <h1 class="text-5xl font-bold">Encrypt & Hide</h1>

        <textarea id="message" placeholder="Enter confidential message..."
            class="w-full p-4 bg-neutral-900 border border-neutral-800 rounded-xl h-40"></textarea>

        <input type="password" id="password" placeholder="Enter secret key"
            class="w-full p-4 bg-neutral-900 border border-neutral-800 rounded-xl">

        <input type="file" id="imageInput" accept="image/*"
            class="w-full p-4 bg-neutral-900 border border-neutral-800 rounded-xl">

        <button onclick="encryptAndHide()" class="px-8 py-3 bg-white text-black rounded-full font-semibold">
            Generate Secure Image
        </button>

        <a id="downloadLink" class="hidden underline text-green-400">Download Encrypted Image</a>
    </section>

    <!-- DECRYPT -->
    <section data-page="decrypt" class="page max-w-5xl mx-auto px-6 space-y-12 pb-32">
        <h1 class="text-5xl font-bold">Extract & Decrypt</h1>

        <input type="file" id="stegoInput" accept="image/*"
            class="w-full p-4 bg-neutral-900 border border-neutral-800 rounded-xl">

        <input type="password" id="decryptPassword" placeholder="Enter secret key"
            class="w-full p-4 bg-neutral-900 border border-neutral-800 rounded-xl">

        <button onclick="extractAndDecrypt()" class="px-8 py-3 bg-white text-black rounded-full font-semibold">
            Reveal Message
        </button>

        <div id="output" class="p-6 bg-neutral-900 border border-neutral-800 rounded-xl text-neutral-300"></div>
    </section>

    <canvas id="canvas"></canvas>

    <script>
        const pages = document.querySelectorAll(".page");
        const overlay = document.querySelector(".overlay");

        function navigate() {
            const hash = location.hash.replace("#", "") || "home";
            const target = document.querySelector(`[data-page="${hash}"]`);
            if (!target) return;
            gsap.to(overlay, {
                y: "0%", duration: 0.6, ease: "power2.inOut", onComplete: () => {
                    pages.forEach(p => p.classList.remove("active"));
                    target.classList.add("active");
                    gsap.from(target.children, { opacity: 0, y: 40, stagger: 0.1, duration: 0.8 });
                    gsap.to(overlay, { y: "100%", duration: 0.6 });
                }
            });
        }
        window.addEventListener("hashchange", navigate);
        document.querySelectorAll("[data-link]").forEach(l => {
            l.onclick = e => { e.preventDefault(); location.hash = l.getAttribute("href"); };
        });
        navigate();

        document.getElementById("themeToggle").onclick = () => {
            document.body.classList.toggle("bg-white");
            document.body.classList.toggle("text-black");
            document.body.classList.toggle("bg-neutral-950");
            document.body.classList.toggle("text-neutral-100");
        };

        async function getKey(password) {
            const enc = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey(
                "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]);
            return crypto.subtle.deriveKey(
                { name: "PBKDF2", salt: enc.encode("obscura"), iterations: 100000, hash: "SHA-256" },
                keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]);
        }

        async function encryptAndHide() {
            const msg = document.getElementById("message").value;
            const password = document.getElementById("password").value;
            const file = document.getElementById("imageInput").files[0];
            if (!msg || !password || !file) return;

            const key = await getKey(password);
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const enc = new TextEncoder();
            const encrypted = await crypto.subtle.encrypt(
                { name: "AES-GCM", iv }, key, enc.encode(msg));

            const payload = new Uint8Array([...iv, ...new Uint8Array(encrypted)]);
            const binary = Array.from(payload).map(b => b.toString(2).padStart(8, "0")).join("") + "1111111111111110";

            const img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = () => {
                const canvas = document.getElementById("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0);
                const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let i = 0;
                for (let j = 0; j < data.data.length && i < binary.length; j += 4) {
                    data.data[j] = (data.data[j] & 254) | binary[i++];
                }
                ctx.putImageData(data, 0, 0);
                const link = document.getElementById("downloadLink");
                link.href = canvas.toDataURL();
                link.download = "secure.png";
                link.classList.remove("hidden");
            };
        }

        async function extractAndDecrypt() {
            const file = document.getElementById("stegoInput").files[0];
            const password = document.getElementById("decryptPassword").value;
            if (!file || !password) return;

            const img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = async () => {
                const canvas = document.getElementById("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0);
                const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

                let binary = "";
                for (let i = 0; i < data.length; i += 4) {
                    binary += data[i] & 1;
                    if (binary.endsWith("1111111111111110")) break;
                }
                binary = binary.replace(/1111111111111110$/, "");
                const bytes = [];
                for (let i = 0; i < binary.length; i += 8) {
                    bytes.push(parseInt(binary.slice(i, i + 8), 2));
                }
                const payload = new Uint8Array(bytes);
                const iv = payload.slice(0, 12);
                const encrypted = payload.slice(12);

                try {
                    const key = await getKey(password);
                    const decrypted = await crypto.subtle.decrypt(
                        { name: "AES-GCM", iv }, key, encrypted);
                    const dec = new TextDecoder();
                    document.getElementById("output").innerText = dec.decode(decrypted);
                } catch {
                    document.getElementById("output").innerText = "Invalid key or corrupted image.";
                }
            };
        }
    </script>

</body>

</html>